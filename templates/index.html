<!DOCTYPE html>
<html>
    {% load staticfiles %}
	<head>

		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Alert system Ukraine</title>

		<link href='https://fonts.googleapis.com/css?family=Roboto:400,500' rel='stylesheet' type='text/css'>

		<script src="{% static 'libs/leaflet/leaflet.js' %}"></script>
		<script src="{% static 'js/d3.v3.min.js' %}" charset="utf-8"></script>

		<script src="{% static 'libs/crossfilter.min.js' %}"></script>
		<script src="{% static 'libs/underscore-min.js' %}"></script>
		<script src="{% static 'js/jquery.min.js' %}"></script>

		<script src="{% static 'js/changeLang.js' %}"></script>
		<script type="text/javascript">
            var setLang = function(newLang) {
                window.localStorage['lang'] = newLang;
            };

            if(!window.localStorage['lang']) {
                setLang('en');
            }
            changeLang(window.localStorage['lang']);
            $(document).ready(function(){
                $('.button-lang-'+window.localStorage['lang']).css({'background': '#ccc','border-color': '#888','color': '#000'});

            });
		</script>

        <link rel="stylesheet" href="{% static 'libs/leaflet/leaflet.css' %}" />

        <script src="{% static 'js/selectize.min.js' %}"></script>
        <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>

        <script src="{% static 'js/jquery-ui.min.js' %}"></script>

        <script src="{% static 'js/jQDateRangeSlider-withRuler-min.js' %}"></script>
        <script src="{% static 'js/FileSaver.min.js' %}"></script>

        <link rel="stylesheet" href="{% static 'css/style.css' %}" />
        <link rel="stylesheet" href="{% static 'css/selectize/selectize.min.css' %}" />
        <link rel="stylesheet" href="{% static 'css/selectize/selectize.default.min.css' %}" />
        <link rel="stylesheet" href="{% static 'css/iThing.css' %}"/>
        <link rel="stylesheet" href="{% static 'font-awesome/css/font-awesome.min.css' %}">
        <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
        <link rel="stylesheet" href="{% static 'css/awesome-bootstrap-checkbox.css' %}" />

        {% comment %} Custom CSS {% endcomment %}


        <link rel="stylesheet" href="{% static 'css/custom.css' %}" />

	</head>
	<body>

        <div class="modal fade bs-example-modal-lg" role="dialog" tabindex="-1" id="dataTableModal" aria-labelledby="myLargeModalLabel">
            <div class="modal-dialog modal-lg" role="document" style="width: 95%">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">Ã—</span></button>
                        {#                                <h4 class="modal-title" id="myLargeModalLabel">Data Table</h4>#}
                    </div>
                    <div class="modal-body data">

                        <table class="table-hover table" id="dataTable">

                            <script type="text/template" id="tplDataTableHead">
                                <td style="width:120px;">Oblast /
                                    <wbr/>
                                    Raion /
                                    <wbr/>
                                    Settlement
                                </td>
                                <td style="width:80px;">Covered / Affected</td>
                                <td style="width:100px;">Type alerts</td>
                                <td style="width:140px;">Type needs</td>
                                <td style="">Item</td>
                                <td style="">Quantity Provided/Needed</td>
                                <td style="width:80px;">Conflict related</td>
                                <td style="width:100px;">Date referral</td>
                                <td style="width:80px;">Gaps-not covered need</td>
                            </script>
                            <script type="text/template" id="tplDataTableRow">
                                <td><%= data.oblast %> / <%= data.raion %> / <%= data.settlement %></td>
                                <td style="text-align:center;"><%= data.covered %> / <%= data.affected %></td>
                                <td style="text-align:center;"><%= data.type %></td>
                                <td><%= data.needs %></td>
                                {#                                            <td><%= data.description %></td>#}
                                {#                                            <td><%= data.context %></td>#}
                                <td><%= data.item %></td>
                                <td><%= data.quantity_response %>/<%= data.quantity %> <%= data.unit %></td>
                                {#                                            <td style="text-align:center;"><% if(data.infoLink.trim()) { %><a href="<%= data.infoLink %>">Link</a><% } %></td>#}
                                <td style="text-align:center;"><% if (data.conflictRelated) { %>Yes<% } else { %>No<% } %>
                                </td>
                                <td style="text-align:center;"><%= conf.dateFormat(data.date) %></td>
                                <td style="text-align:center;"></td>
                            </script>

                        </table>

                    </div>

                    <nav>
                        <ul id="dataTablePagination" class="pagination">
                        </ul>
                    </nav>

                </div>
            </div>
        </div>

        <div class="header-wrapper">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header header" style="width: 100%">
                        <ul class="nav navbar-nav">
                            <li>
                                <button class="header-button fleft translate resetFilters" id="resetFilters">RESET
                                    FILTERS
                                </button>
                            </li>

                            {% if user.is_authenticated %}
                                <li>
                                    <div class="header-controls">
                                        <a href="/admin/alert_system/alert/add/" class="header-button fleft translate">ADD
                                            AN ALERT</a>
                                    </div>
                                </li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                       aria-haspopup="true" aria-expanded="false">{{ user }} <span class="caret"></span></a>
                                    <ul class="dropdown-menu">
                                        <li><a href="/admin">Admin Panel</a></li>
                                        {% comment %}<li><a href="/admin/moderation/moderatedobject/">Moderation</a></li>{% endcomment %}
                                        <li><a href="/admin/password_change/">Change Password</a></li>
                                        <li role="separator" class="divider"></li>
                                        <li><a href="/logout">Log Out</a></li>
                                    </ul>
                                </li>

                                {% comment %}
                                <div class="header-button fleft">
                                    <button class="button-lang-en translate"  onclick="setLang('en');location.reload();">EN</button>
                                    <button class="button-lang-ua translate"  onclick="setLang('ua');location.reload();">UA</button>
                                    <button class="button-lang-ru translate"  onclick="setLang('ru');location.reload();">RU</button>
                                </div>
                            {% endcomment %}
                            {% else %}
                                <li><a href="/login/">Sign In</a></li>
                            {% endif %}

                        </ul>

                        <div class="navbar-right">

                            <p class="header-text navbar-text" id="filterCounter"></p>
                            <script type="text/template" id="tplFilterCounter">
                                <%= data.value %> <span class="translate">alerts selected of</span> <%= data.total %>
                            </script>

                            <button id="openDataTable" type="button" class="header-button translate" data-toggle="modal"
                                    data-target=".bs-example-modal-lg">DATA TABLE
                            </button>
                            <button class="button header-button translate save-data">DOWNLOAD DATA</button>

                        </div>

                    </div>
                </div>
            </nav>
        </div>

        <div class="main-wrapper">
            <main>

                <div id="map"></div>

                <div class="bottom-wrapper">

                    <div class="bottom">
                        <div id="slider"></div>
                    </div>
                </div>

                <div id="mapLegend" class="translate-filter"></div>

                <div class="data-table" style="display: none">
                    <div class="data-table-close" id="dataTableClose">&times;</div>
                    <div class="data-table-overflow">
                        <table></table>
                    </div>

                </div>
            </main>
        </div>

        <div class="aside-wrapper">
            <aside>

                <div class="filter filter-cluster translate-filter">
                    <h3>Cluster</h3>
                    <div id="filterCluster"></div>
                </div>

                <div class="filter filter-partner translate-filter" style="display: none">

                    <h3>Response partner
                        <button id="clearPartners" class="btn btn-sm" style="display: none">Clear</button>
                    </h3>
                    <div class="checkbox" style="display: none">
                        <input type="checkbox" id="filterPartnersAll"/>
                        <label for="filterPartnersAll">
                            All response partners
                        </label>
                    </div>


                    <div id="filterPartnerSelected"></div>

                    <select id="filterPartner" class="demo-default selectized" multiple="multiple"
                            style="display: none;" placeholder="- Select partner to filter -" tabindex="-1">
                    </select>

                </div>


                <div class="filter filter-status translate-filter">
                    <h3>Status</h3>
                    <div id="filterStatus"></div>
                </div>

                <div class="filter filter-type translate-filter">
                    <h3>Alert type</h3>
                    <div id="filterType"></div>
                </div>


                <div class="filter filter-need translate-filter">
                    <h3>Needs type</h3>
                    <div id="filterNeed"></div>
                </div>

                <div class="filter filter-oblast">
                </div>

                <div class="filter filter-location translate-filter" style="height: 230px">
                    <h3>
                        Location
                        <button id="clearLocation" class="btn btn-sm" style="display: none">Clear</button>
                    </h3>

                    <div>
                        <select id="locations-filter" class="selectized" multiple="multiple" style="display: none;"
                                placeholder="- Select location to filter -" tabindex="-1">
                        </select>
                    </div>
                </div>
            </aside>
        </div>


        <script type="text/template" id="tplPopup">
        <p class="popup-title"><%= data.title %></p>
        <p>
            <b>Clusters:</b> <%= data.clusters.join(', ') %>
        </p>
        <p>
            <b>Number of covered/affected people:</b> <%= data.covered %>/<%= data.affected %>
        </p>
        <p>
            <b>Type alert:</b> <%= data.type %>
        </p>
        <p>
            <b>Type needs:</b> <%= data.needs.join(', ') %>
        </p>
        <p>
            <b>Context:</b><br/>
            <span style="white-space:pre-wrap"><%= data.context %></span>
        </p>
        <p>
            <b>Description:</b><br/>
            <span style="white-space:pre-wrap"><%= data.description %></span>
        </p>

        <p>
            <b>Related to conflict:</b>
            <% if(data.conflictRelated) { %> Yes <% } else { %> No <% } %>
        </p>


        <p>
            <b>Date referral:</b> <%= conf.dateFormat(data.date) %>
        </p>

    </script>

    <script src="{% static 'js/topojson.v1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'data/grey_zone.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/logic/set_conf.js' %}"></script>


    <script type="text/javascript">
        window.conf = setConf('{{ data }}');
    </script>

    <script src="{% static 'js/logic/map.js' %}"></script>
    <script src="{% static 'js/script.js' %}"></script>

	</body>

</html>